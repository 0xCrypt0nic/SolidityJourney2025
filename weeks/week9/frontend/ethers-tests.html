<!DOCTYPE html>
<html>

<head>
    <title>ethers.js Test</title>
</head>

<body>
    <button id="connect">Connect MetaMask</button>
    <button id="getCandidates">Get Candidates</button>
    <p id="result"></p>

    <script type="module">
        import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@5.6.9/dist/ethers.esm.min.js";
        let provider;
        let signer;
        let contract;
        const votingAddress = "0x027183dA726d16BA5EE01eB599Ea0F048C14b522"; // From Week 2
        const ABI = [
            {
                "inputs": [
                    {
                        "internalType": "string[]",
                        "name": "candidateNames",
                        "type": "string[]"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "voter",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "candidateId",
                        "type": "uint256"
                    }
                ],
                "name": "VoteCast",
                "type": "event"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "name": "candidates",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "name",
                        "type": "string"
                    },
                    {
                        "internalType": "uint256",
                        "name": "voteCount",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "_candidateId",
                        "type": "uint256"
                    }
                ],
                "name": "getCandidate",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "",
                        "type": "string"
                    },
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "name": "hasVoted",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "_candidateId",
                        "type": "uint256"
                    }
                ],
                "name": "vote",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];

        document.getElementById("connect").onclick = async () => {
            if (window.ethereum) {
                provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                contract = new ethers.Contract(votingAddress, ABI, signer);
                document.getElementById("result").innerHTML = `
                Connected: ${await signer.getAddress()}`;

            } else {
                document.getElementById("result").innerHTML = "MetaMask not found!";
            }
        };

        document.getElementById("getCandidates").onclick = async () => {
            if (contract) {
                try {
                    const candidates = await contract.getCandidate(0);
                    console.log(candidates);
                } catch (error) {
                    document.getElementById("result").innerHTML =
                        "Error fetching candidates";
                    console.error(error);
                }
            }
        };
    </script>
</body>

</html>